CCS PCH C Compiler, Version 4.124, 5967               31-out-12 15:28

               Filename: C:\Users\cuki\Eletronica\Projetos\I2CGit\I2C\mestre.lst

               ROM used: 1010 bytes (3%)
                         Largest free fragment is 31754
               RAM used: 28 (2%) at main() level
                         35 (2%) worst case
               Stack:    4 worst case (3 in main + 1 for interrupts)

*
0000:  GOTO   028A
*
0008:  MOVWF  04
000A:  MOVFF  FD8,05
000E:  MOVFF  FE0,06
0012:  MOVLB  0
0014:  MOVFF  FE9,0C
0018:  MOVFF  FEA,07
001C:  MOVFF  FE1,08
0020:  MOVFF  FE2,09
0024:  MOVFF  FD9,0A
0028:  MOVFF  FDA,0B
002C:  MOVFF  FF3,12
0030:  MOVFF  FF4,13
0034:  MOVFF  FFA,14
0038:  MOVFF  FF5,15
003C:  MOVFF  FF6,16
0040:  MOVFF  FF7,17
0044:  MOVFF  00,0E
0048:  MOVFF  01,0F
004C:  MOVFF  02,10
0050:  MOVFF  03,11
0054:  BTFSS  FF0.3
0056:  GOTO   0060
005A:  BTFSC  FF0.0
005C:  GOTO   00BA
0060:  BTFSS  FF0.4
0062:  GOTO   006C
0066:  BTFSC  FF0.1
0068:  GOTO   00C6
006C:  MOVFF  0E,00
0070:  MOVFF  0F,01
0074:  MOVFF  10,02
0078:  MOVFF  11,03
007C:  MOVFF  0C,FE9
0080:  MOVFF  07,FEA
0084:  BSF    07.7
0086:  MOVFF  08,FE1
008A:  MOVFF  09,FE2
008E:  MOVFF  0A,FD9
0092:  MOVFF  0B,FDA
0096:  MOVFF  12,FF3
009A:  MOVFF  13,FF4
009E:  MOVFF  14,FFA
00A2:  MOVFF  15,FF5
00A6:  MOVFF  16,FF6
00AA:  MOVFF  17,FF7
00AE:  MOVF   04,W
00B0:  MOVFF  06,FE0
00B4:  MOVFF  05,FD8
00B8:  RETFIE 0
.................... /* 
....................  * mestre.c 
....................  * 
....................  *  Created on: 22/10/2012 
....................  *      Author: cuki 
....................  */ 
....................  
.................... #include <18F252.h> 
.................... //////// Standard Header file for the PIC18F252 device //////////////// 
.................... #device PIC18F252 
.................... #list 
....................  
....................  
.................... #fuses	H4,NOOSCSEN,NOPUT,NOBROWNOUT,NOWDT,NOSTVREN,NOLVP 
.................... #fuses	NODEBUG,NOPROTECT,NOCPB,NOCPD,NOWRT,NOWRTC,NOWRTB 
.................... #fuses	NOWRTD,NOEBTR,NOEBTRB 
....................  
.................... #use delay(clock=32MHz, crystal=8MHz) 
*
0146:  CLRF   FEA
0148:  MOVLW  1E
014A:  MOVWF  FE9
014C:  MOVF   FEF,W
014E:  BZ    016A
0150:  MOVLW  0A
0152:  MOVWF  01
0154:  CLRF   00
0156:  DECFSZ 00,F
0158:  BRA    0156
015A:  DECFSZ 01,F
015C:  BRA    0154
015E:  MOVLW  5F
0160:  MOVWF  00
0162:  DECFSZ 00,F
0164:  BRA    0162
0166:  DECFSZ FEF,F
0168:  BRA    0150
016A:  RETURN 0
.................... #use rs232(xmit=pin_c6, rcv=pin_c7, baud=9600, parity=E, stop=1) 
016C:  MOVLW  08
016E:  MOVWF  01
0170:  CLRF   21
0172:  MOVFF  20,00
0176:  MOVF   00,W
0178:  XORWF  21,F
017A:  RRCF   00,F
017C:  DECFSZ 01,F
017E:  BRA    0176
0180:  BTFSS  F9E.4
0182:  BRA    0180
0184:  MOVLW  FE
0186:  ANDWF  FAC,F
0188:  BTFSC  21.0
018A:  BSF    FAC.0
018C:  MOVFF  20,FAD
0190:  RETURN 0
.................... #use i2c(master, scl=pin_c3, sda=pin_c4, fast=1000000, force_hw) 
*
020E:  BCF    FC6.7
0210:  BCF    F9E.3
0212:  MOVFF  22,FC9
0216:  MOVLW  02
0218:  BTFSC  FC6.7
021A:  BRA    0226
021C:  BTFSS  F9E.3
021E:  BRA    021C
0220:  MOVLW  00
0222:  BTFSC  FC5.6
0224:  MOVLW  01
0226:  MOVWF  01
0228:  RETURN 0
....................  
.................... #define addr_device 0xB0 
.................... #define memory_addr 0x01 
.................... #define data_addr	0x55 
.................... #define debounce	500 
....................  
.................... static int ext1, ext2; 
....................  
.................... #INT_EXT1 
.................... void isr_ext1() { 
.................... 	clear_interrupt(INT_EXT1); 
*
00BA:  BCF    FF0.0
.................... 	ext1 = 1; 
00BC:  MOVLW  01
00BE:  MOVWF  19
.................... } 
....................  
00C0:  BCF    FF0.0
00C2:  GOTO   006C
.................... #INT_EXT2 
.................... void isr_ext2() { 
.................... 	clear_interrupt(INT_EXT2); 
00C6:  BCF    FF0.1
.................... 	ext2 = 1; 
00C8:  MOVLW  01
00CA:  MOVWF  1A
.................... } 
....................  
00CC:  BCF    FF0.1
00CE:  GOTO   006C
.................... short handshake(int addr) { 
*
022A:  BSF    21.0
.................... 	short ack = 1; 
.................... 	i2c_start(); 
022C:  BSF    FC5.0
022E:  BTFSC  FC5.0
0230:  BRA    022E
.................... 	ack = i2c_write(addr); 
0232:  MOVFF  20,22
0236:  RCALL  020E
0238:  MOVF   01,W
023A:  BCF    21.0
023C:  BTFSC  01.0
023E:  BSF    21.0
.................... 	i2c_stop(); 
0240:  BSF    FC5.2
0242:  BTFSC  FC5.2
0244:  BRA    0242
.................... 	return ack; 
0246:  MOVLW  00
0248:  BTFSC  21.0
024A:  MOVLW  01
024C:  MOVWF  01
.................... } 
024E:  RETURN 0
....................  
.................... int send_i2c(int addr, int mem, int data) { 
.................... 	if (handshake(addr)) 
0250:  MOVFF  1D,20
0254:  RCALL  022A
0256:  MOVF   01,F
0258:  BZ    0262
.................... 		return 0xFF; 
025A:  MOVLW  FF
025C:  MOVWF  01
025E:  BRA    0286
.................... 	else { 
0260:  BRA    0286
.................... 		i2c_start(); 
0262:  BSF    FC5.0
0264:  BTFSC  FC5.0
0266:  BRA    0264
.................... 		i2c_write(addr); 
0268:  MOVFF  1D,22
026C:  RCALL  020E
.................... 		i2c_write(mem); 
026E:  MOVFF  1E,22
0272:  RCALL  020E
.................... 		i2c_write(data); 
0274:  MOVFF  1F,22
0278:  RCALL  020E
.................... 		i2c_stop(); 
027A:  BSF    FC5.2
027C:  BTFSC  FC5.2
027E:  BRA    027C
.................... 		return 0; 
0280:  MOVLW  00
0282:  MOVWF  01
0284:  BRA    0286
.................... 	} 
.................... } 
0286:  GOTO   03BA (RETURN)
....................  
.................... int read_i2c(int addr, int data) { 
.................... 	int retorno = 0; 
.................... 	if (handshake(addr)) 
.................... 		return 0xFF; 
.................... 	else { 
.................... 		i2c_start(); 
.................... 		i2c_write(addr); 
.................... 		i2c_write(data); 
.................... 		i2c_start(); 
.................... 		i2c_write(addr + 1); 
.................... 		retorno = i2c_read(0); 
.................... 		i2c_stop(); 
.................... 		return retorno; 
.................... 	} 
.................... } 
....................  
.................... int main(void) { 
028A:  CLRF   FF8
028C:  BCF    FD0.7
028E:  BSF    07.7
0290:  CLRF   FEA
0292:  CLRF   FE9
0294:  MOVLW  33
0296:  MOVWF  FAF
0298:  MOVLW  E2
029A:  MOVWF  FAC
029C:  MOVLW  D0
029E:  MOVWF  FAB
02A0:  BSF    F94.3
02A2:  BSF    F94.4
02A4:  MOVLW  07
02A6:  MOVWF  FC8
02A8:  MOVLW  28
02AA:  MOVWF  FC6
02AC:  BSF    FC7.7
02AE:  BCF    FC7.6
02B0:  BSF    FC1.0
02B2:  BSF    FC1.1
02B4:  BSF    FC1.2
02B6:  BCF    FC1.3
02B8:  CLRF   19
02BA:  CLRF   1A
....................  
.................... 	port_b_pullups(true); 
02BC:  BCF    FF1.7
.................... 	enable_interrupts(INT_EXT1_H2L); 
02BE:  BSF    FF0.3
02C0:  BCF    FF1.5
.................... 	enable_interrupts(INT_EXT2_H2L); 
02C2:  BSF    FF0.4
02C4:  BCF    FF1.4
.................... 	enable_interrupts(GLOBAL); 
02C6:  MOVLW  C0
02C8:  IORWF  FF2,F
.................... 	delay_ms(500); 
02CA:  MOVLW  02
02CC:  MOVWF  1D
02CE:  MOVLW  FA
02D0:  MOVWF  1E
02D2:  RCALL  0146
02D4:  DECFSZ 1D,F
02D6:  BRA    02CE
....................  
.................... 	while (true) { 
.................... 		printf("\fCheck <- ext1\n\rSend  <- ext2\n\r"); 
02D8:  MOVLW  D2
02DA:  MOVWF  FF6
02DC:  MOVLW  00
02DE:  MOVWF  FF7
02E0:  RCALL  0192
.................... 		if (ext1) { 
02E2:  MOVF   19,F
02E4:  BZ    0358
.................... 			ext1 = 0; 
02E6:  CLRF   19
.................... 			int ack = 0; 
02E8:  CLRF   1B
.................... 			printf("ext1"); 
02EA:  MOVLW  F2
02EC:  MOVWF  FF6
02EE:  MOVLW  00
02F0:  MOVWF  FF7
02F2:  RCALL  0192
.................... 			delay_ms(debounce); 
02F4:  MOVLW  02
02F6:  MOVWF  1D
02F8:  MOVLW  FA
02FA:  MOVWF  1E
02FC:  RCALL  0146
02FE:  DECFSZ 1D,F
0300:  BRA    02F8
.................... 			printf("\fIniciando 0x%X", addr_device); 
0302:  MOVLW  F8
0304:  MOVWF  FF6
0306:  MOVLW  00
0308:  MOVWF  FF7
030A:  MOVLW  0D
030C:  MOVWF  1D
030E:  RCALL  01B2
0310:  MOVLW  B0
0312:  MOVWF  1D
0314:  MOVLW  37
0316:  MOVWF  1E
0318:  RCALL  01D0
.................... 			do { 
.................... 				ack = handshake(addr_device); 
031A:  MOVLW  B0
031C:  MOVWF  20
031E:  RCALL  022A
0320:  MOVFF  01,1B
.................... 				if (ack) { 
0324:  MOVF   1B,F
0326:  BZ    0334
.................... 					printf("\n\rNao repondendo"); 
0328:  MOVLW  08
032A:  MOVWF  FF6
032C:  MOVLW  01
032E:  MOVWF  FF7
0330:  RCALL  0192
.................... 				} else 
0332:  BRA    033E
.................... 					printf("\n\rOk"); 
0334:  MOVLW  1A
0336:  MOVWF  FF6
0338:  MOVLW  01
033A:  MOVWF  FF7
033C:  RCALL  0192
.................... 				delay_ms(1000); 
033E:  MOVLW  04
0340:  MOVWF  1D
0342:  MOVLW  FA
0344:  MOVWF  1E
0346:  RCALL  0146
0348:  DECFSZ 1D,F
034A:  BRA    0342
.................... 			} while (ack && !ext1); 
034C:  MOVF   1B,F
034E:  BZ    0354
0350:  MOVF   19,F
0352:  BZ    031A
.................... 			ext1 = 0; 
0354:  CLRF   19
.................... 		} else if (ext2) { 
0356:  BRA    03E0
0358:  MOVF   1A,F
035A:  BZ    03E0
.................... 			ext2 = 0; 
035C:  CLRF   1A
.................... 			printf("ext1"); 
035E:  MOVLW  20
0360:  MOVWF  FF6
0362:  MOVLW  01
0364:  MOVWF  FF7
0366:  RCALL  0192
.................... 			delay_ms(debounce); 
0368:  MOVLW  02
036A:  MOVWF  1D
036C:  MOVLW  FA
036E:  MOVWF  1E
0370:  RCALL  0146
0372:  DECFSZ 1D,F
0374:  BRA    036C
.................... 			printf("\fEscrevendo 0x%X\nem 0x%X ", data_addr, memory_addr); 
0376:  MOVLW  26
0378:  MOVWF  FF6
037A:  MOVLW  01
037C:  MOVWF  FF7
037E:  MOVLW  0E
0380:  MOVWF  1D
0382:  RCALL  01B2
0384:  MOVLW  55
0386:  MOVWF  1D
0388:  MOVLW  37
038A:  MOVWF  1E
038C:  RCALL  01D0
038E:  MOVLW  36
0390:  MOVWF  FF6
0392:  MOVLW  01
0394:  MOVWF  FF7
0396:  MOVLW  06
0398:  MOVWF  1D
039A:  RCALL  01B2
039C:  MOVLW  01
039E:  MOVWF  1D
03A0:  MOVLW  37
03A2:  MOVWF  1E
03A4:  RCALL  01D0
03A6:  MOVLW  20
03A8:  MOVWF  20
03AA:  RCALL  016C
.................... 			int aux = send_i2c(addr_device, memory_addr, data_addr); 
03AC:  MOVLW  B0
03AE:  MOVWF  1D
03B0:  MOVLW  01
03B2:  MOVWF  1E
03B4:  MOVLW  55
03B6:  MOVWF  1F
03B8:  BRA    0250
03BA:  MOVFF  01,1C
.................... //			printf("  %s", (aux == 0xFF) ? "Err" : "Ok"); 
.................... 			if (aux == 0xFF) 
03BE:  INCFSZ 1C,W
03C0:  BRA    03CE
.................... 				printf(" Err"); 
03C2:  MOVLW  40
03C4:  MOVWF  FF6
03C6:  MOVLW  01
03C8:  MOVWF  FF7
03CA:  RCALL  0192
.................... 			else 
03CC:  BRA    03E0
.................... 				printf(" Ok"); 
03CE:  MOVLW  20
03D0:  MOVWF  20
03D2:  RCALL  016C
03D4:  MOVLW  4F
03D6:  MOVWF  20
03D8:  RCALL  016C
03DA:  MOVLW  6B
03DC:  MOVWF  20
03DE:  RCALL  016C
.................... 		} 
.................... 		delay_ms(1000); 
03E0:  MOVLW  04
03E2:  MOVWF  1D
03E4:  MOVLW  FA
03E6:  MOVWF  1E
03E8:  RCALL  0146
03EA:  DECFSZ 1D,F
03EC:  BRA    03E4
.................... 	} 
03EE:  BRA    02D8
.................... 	return 0; 
03F0:  MOVLW  00
03F2:  MOVWF  01
.................... } 
....................  
.................... /*		switch (cont++) { 
....................  case 0: 
....................  
....................  break; 
....................  case 1: 
....................  aux = 0; 
....................  printf("\fEnviando 0x%X\nem 0x%X :", data_addr, memory_addr); 
....................  aux = send_i2c(addr_device, memory_addr, data_addr); 
....................  printf("\n%s", aux == 0xFF ? "Error" : "Ok"); 
....................  break; 
....................  case 2: 
....................  aux = 0; 
....................  printf("\fLendo em 0x%X", memory_addr); 
....................  aux = read_i2c(addr_device, memory_addr); 
....................  printf("\nleitura: 0x%X", aux); 
....................  break; 
....................  default: 
....................  cont = 0; 
....................  break; 
....................  }*/ 
03F4:  SLEEP 

Configuration Fuses:
   Word  1: 2600   H4 NOOSCSEN
   Word  2: 0E0D   NOPUT NOBROWNOUT BORV20 NOWDT WDT128
   Word  3: 0100   CCP2C1
   Word  4: 0080   NOSTVREN NOLVP NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
