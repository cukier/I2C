CCS PCH C Compiler, Version 4.124, 5967               31-out-12 14:57

               Filename: C:\Users\cuki\Eletronica\Projetos\I2CGit\I2C\mestre.lst

               ROM used: 1020 bytes (3%)
                         Largest free fragment is 31744
               RAM used: 28 (2%) at main() level
                         35 (2%) worst case
               Stack:    4 worst case (3 in main + 1 for interrupts)

*
0000:  GOTO   0294
*
0008:  MOVWF  04
000A:  MOVFF  FD8,05
000E:  MOVFF  FE0,06
0012:  MOVLB  0
0014:  MOVFF  FE9,0C
0018:  MOVFF  FEA,07
001C:  MOVFF  FE1,08
0020:  MOVFF  FE2,09
0024:  MOVFF  FD9,0A
0028:  MOVFF  FDA,0B
002C:  MOVFF  FF3,12
0030:  MOVFF  FF4,13
0034:  MOVFF  FFA,14
0038:  MOVFF  FF5,15
003C:  MOVFF  FF6,16
0040:  MOVFF  FF7,17
0044:  MOVFF  00,0E
0048:  MOVFF  01,0F
004C:  MOVFF  02,10
0050:  MOVFF  03,11
0054:  BTFSS  FF0.3
0056:  GOTO   0060
005A:  BTFSC  FF0.0
005C:  GOTO   00BA
0060:  BTFSS  FF0.4
0062:  GOTO   006C
0066:  BTFSC  FF0.1
0068:  GOTO   00C6
006C:  MOVFF  0E,00
0070:  MOVFF  0F,01
0074:  MOVFF  10,02
0078:  MOVFF  11,03
007C:  MOVFF  0C,FE9
0080:  MOVFF  07,FEA
0084:  BSF    07.7
0086:  MOVFF  08,FE1
008A:  MOVFF  09,FE2
008E:  MOVFF  0A,FD9
0092:  MOVFF  0B,FDA
0096:  MOVFF  12,FF3
009A:  MOVFF  13,FF4
009E:  MOVFF  14,FFA
00A2:  MOVFF  15,FF5
00A6:  MOVFF  16,FF6
00AA:  MOVFF  17,FF7
00AE:  MOVF   04,W
00B0:  MOVFF  06,FE0
00B4:  MOVFF  05,FD8
00B8:  RETFIE 0
.................... /* 
....................  * mestre.c 
....................  * 
....................  *  Created on: 22/10/2012 
....................  *      Author: cuki 
....................  */ 
....................  
.................... #include <18F252.h> 
.................... //////// Standard Header file for the PIC18F252 device //////////////// 
.................... #device PIC18F252 
.................... #list 
....................  
....................  
.................... #fuses	H4,NOOSCSEN,NOPUT,NOBROWNOUT,NOWDT,NOSTVREN,NOLVP 
.................... #fuses	NODEBUG,NOPROTECT,NOCPB,NOCPD,NOWRT,NOWRTC,NOWRTB 
.................... #fuses	NOWRTD,NOEBTR,NOEBTRB 
....................  
.................... #use delay(clock=32MHz, crystal=8MHz) 
*
0146:  CLRF   FEA
0148:  MOVLW  1E
014A:  MOVWF  FE9
014C:  MOVF   FEF,W
014E:  BZ    016A
0150:  MOVLW  0A
0152:  MOVWF  01
0154:  CLRF   00
0156:  DECFSZ 00,F
0158:  BRA    0156
015A:  DECFSZ 01,F
015C:  BRA    0154
015E:  MOVLW  5F
0160:  MOVWF  00
0162:  DECFSZ 00,F
0164:  BRA    0162
0166:  DECFSZ FEF,F
0168:  BRA    0150
016A:  RETURN 0
.................... #use rs232(xmit=pin_c6, rcv=pin_c7, baud=9600, parity=E, stop=1) 
016C:  MOVLW  08
016E:  MOVWF  01
0170:  CLRF   21
0172:  MOVFF  20,00
0176:  MOVF   00,W
0178:  XORWF  21,F
017A:  RRCF   00,F
017C:  DECFSZ 01,F
017E:  BRA    0176
0180:  BTFSS  F9E.4
0182:  BRA    0180
0184:  MOVLW  FE
0186:  ANDWF  FAC,F
0188:  BTFSC  21.0
018A:  BSF    FAC.0
018C:  MOVFF  20,FAD
0190:  RETURN 0
.................... #use i2c(master, scl=pin_c3, sda=pin_c4, fast=1000000, force_hw) 
*
020E:  BCF    FC6.7
0210:  BCF    F9E.3
0212:  MOVFF  22,FC9
0216:  MOVLW  02
0218:  BTFSC  FC6.7
021A:  BRA    0226
021C:  BTFSS  F9E.3
021E:  BRA    021C
0220:  MOVLW  00
0222:  BTFSC  FC5.6
0224:  MOVLW  01
0226:  MOVWF  01
0228:  RETURN 0
....................  
.................... #define addr_device 0xB0 
.................... #define memory_addr 0x01 
.................... #define data_addr	0x55 
.................... #define debounce	500 
....................  
.................... static int ext1, ext2; 
....................  
.................... #INT_EXT1 
.................... void isr_ext1() { 
.................... 	clear_interrupt(INT_EXT1); 
*
00BA:  BCF    FF0.0
.................... 	ext1 = 1; 
00BC:  MOVLW  01
00BE:  MOVWF  19
.................... } 
....................  
00C0:  BCF    FF0.0
00C2:  GOTO   006C
.................... #INT_EXT2 
.................... void isr_ext2() { 
.................... 	clear_interrupt(INT_EXT2); 
00C6:  BCF    FF0.1
.................... 	ext2 = 1; 
00C8:  MOVLW  01
00CA:  MOVWF  1A
.................... } 
....................  
00CC:  BCF    FF0.1
00CE:  GOTO   006C
.................... short handshake(int addr) { 
*
022A:  BSF    21.0
.................... 	short ack = 1; 
.................... 	i2c_start(); 
022C:  BSF    FC5.0
022E:  BTFSC  FC5.0
0230:  BRA    022E
.................... 	ack = i2c_write(addr); 
0232:  MOVFF  20,22
0236:  RCALL  020E
0238:  MOVF   01,W
023A:  BCF    21.0
023C:  BTFSC  01.0
023E:  BSF    21.0
.................... 	i2c_stop(); 
0240:  BSF    FC5.2
0242:  BTFSC  FC5.2
0244:  BRA    0242
.................... 	delay_us(1); 
0246:  MOVLW  02
0248:  MOVWF  00
024A:  DECFSZ 00,F
024C:  BRA    024A
024E:  NOP   
.................... 	return ack; 
0250:  MOVLW  00
0252:  BTFSC  21.0
0254:  MOVLW  01
0256:  MOVWF  01
.................... } 
0258:  RETURN 0
....................  
.................... int send_i2c(int addr, int mem, int data) { 
.................... 	if (handshake(addr)) 
025A:  MOVFF  1D,20
025E:  RCALL  022A
0260:  MOVF   01,F
0262:  BZ    026C
.................... 		return 0xFF; 
0264:  MOVLW  FF
0266:  MOVWF  01
0268:  BRA    0290
.................... 	else { 
026A:  BRA    0290
.................... 		i2c_start(); 
026C:  BSF    FC5.0
026E:  BTFSC  FC5.0
0270:  BRA    026E
.................... 		i2c_write(addr); 
0272:  MOVFF  1D,22
0276:  RCALL  020E
.................... 		i2c_write(mem); 
0278:  MOVFF  1E,22
027C:  RCALL  020E
.................... 		i2c_write(data); 
027E:  MOVFF  1F,22
0282:  RCALL  020E
.................... 		i2c_stop(); 
0284:  BSF    FC5.2
0286:  BTFSC  FC5.2
0288:  BRA    0286
.................... 		return 0; 
028A:  MOVLW  00
028C:  MOVWF  01
028E:  BRA    0290
.................... 	} 
.................... } 
0290:  GOTO   03C4 (RETURN)
....................  
.................... int read_i2c(int addr, int data) { 
.................... 	int retorno = 0; 
.................... 	if (handshake(addr)) 
.................... 		return 0xFF; 
.................... 	else { 
.................... 		i2c_start(); 
.................... 		i2c_write(addr); 
.................... 		i2c_write(data); 
.................... 		i2c_start(); 
.................... 		i2c_write(addr + 1); 
.................... 		retorno = i2c_read(0); 
.................... 		i2c_stop(); 
.................... 		return retorno; 
.................... 	} 
.................... } 
....................  
.................... int main(void) { 
0294:  CLRF   FF8
0296:  BCF    FD0.7
0298:  BSF    07.7
029A:  CLRF   FEA
029C:  CLRF   FE9
029E:  MOVLW  33
02A0:  MOVWF  FAF
02A2:  MOVLW  E2
02A4:  MOVWF  FAC
02A6:  MOVLW  D0
02A8:  MOVWF  FAB
02AA:  BSF    F94.3
02AC:  BSF    F94.4
02AE:  MOVLW  07
02B0:  MOVWF  FC8
02B2:  MOVLW  28
02B4:  MOVWF  FC6
02B6:  BSF    FC7.7
02B8:  BCF    FC7.6
02BA:  BSF    FC1.0
02BC:  BSF    FC1.1
02BE:  BSF    FC1.2
02C0:  BCF    FC1.3
02C2:  CLRF   19
02C4:  CLRF   1A
....................  
.................... 	port_b_pullups(true); 
02C6:  BCF    FF1.7
.................... 	enable_interrupts(INT_EXT1_H2L); 
02C8:  BSF    FF0.3
02CA:  BCF    FF1.5
.................... 	enable_interrupts(INT_EXT2_H2L); 
02CC:  BSF    FF0.4
02CE:  BCF    FF1.4
.................... 	enable_interrupts(GLOBAL); 
02D0:  MOVLW  C0
02D2:  IORWF  FF2,F
.................... 	delay_ms(500); 
02D4:  MOVLW  02
02D6:  MOVWF  1D
02D8:  MOVLW  FA
02DA:  MOVWF  1E
02DC:  RCALL  0146
02DE:  DECFSZ 1D,F
02E0:  BRA    02D8
....................  
.................... 	while (true) { 
.................... 		printf("\fCheck <- ext1\n\rSend  <- ext2\n\r"); 
02E2:  MOVLW  D2
02E4:  MOVWF  FF6
02E6:  MOVLW  00
02E8:  MOVWF  FF7
02EA:  RCALL  0192
.................... 		if (ext1) { 
02EC:  MOVF   19,F
02EE:  BZ    0362
.................... 			ext1 = 0; 
02F0:  CLRF   19
.................... 			int ack = 0; 
02F2:  CLRF   1B
.................... 			printf("ext1"); 
02F4:  MOVLW  F2
02F6:  MOVWF  FF6
02F8:  MOVLW  00
02FA:  MOVWF  FF7
02FC:  RCALL  0192
.................... 			delay_ms(debounce); 
02FE:  MOVLW  02
0300:  MOVWF  1D
0302:  MOVLW  FA
0304:  MOVWF  1E
0306:  RCALL  0146
0308:  DECFSZ 1D,F
030A:  BRA    0302
.................... 			do { 
.................... 				printf("\fIniciando 0x%X", addr_device); 
030C:  MOVLW  F8
030E:  MOVWF  FF6
0310:  MOVLW  00
0312:  MOVWF  FF7
0314:  MOVLW  0D
0316:  MOVWF  1D
0318:  RCALL  01B2
031A:  MOVLW  B0
031C:  MOVWF  1D
031E:  MOVLW  37
0320:  MOVWF  1E
0322:  RCALL  01D0
.................... 				ack = handshake(addr_device); 
0324:  MOVLW  B0
0326:  MOVWF  20
0328:  RCALL  022A
032A:  MOVFF  01,1B
.................... 				if (ack) { 
032E:  MOVF   1B,F
0330:  BZ    033E
.................... 					printf("\n\rNao repondendo"); 
0332:  MOVLW  08
0334:  MOVWF  FF6
0336:  MOVLW  01
0338:  MOVWF  FF7
033A:  RCALL  0192
.................... 				} else 
033C:  BRA    0348
.................... 					printf("\n\rOk"); 
033E:  MOVLW  1A
0340:  MOVWF  FF6
0342:  MOVLW  01
0344:  MOVWF  FF7
0346:  RCALL  0192
.................... 				delay_ms(1000); 
0348:  MOVLW  04
034A:  MOVWF  1D
034C:  MOVLW  FA
034E:  MOVWF  1E
0350:  RCALL  0146
0352:  DECFSZ 1D,F
0354:  BRA    034C
.................... 			} while (ack && !ext1); 
0356:  MOVF   1B,F
0358:  BZ    035E
035A:  MOVF   19,F
035C:  BZ    030C
.................... 			ext1 = 0; 
035E:  CLRF   19
.................... 		} else if (ext2) { 
0360:  BRA    03EA
0362:  MOVF   1A,F
0364:  BZ    03EA
.................... 			ext2 = 0; 
0366:  CLRF   1A
.................... 			printf("ext1"); 
0368:  MOVLW  20
036A:  MOVWF  FF6
036C:  MOVLW  01
036E:  MOVWF  FF7
0370:  RCALL  0192
.................... 			delay_ms(debounce); 
0372:  MOVLW  02
0374:  MOVWF  1D
0376:  MOVLW  FA
0378:  MOVWF  1E
037A:  RCALL  0146
037C:  DECFSZ 1D,F
037E:  BRA    0376
.................... 			printf("\fEscrevendo 0x%X\nem 0x%X ", data_addr, memory_addr); 
0380:  MOVLW  26
0382:  MOVWF  FF6
0384:  MOVLW  01
0386:  MOVWF  FF7
0388:  MOVLW  0E
038A:  MOVWF  1D
038C:  RCALL  01B2
038E:  MOVLW  55
0390:  MOVWF  1D
0392:  MOVLW  37
0394:  MOVWF  1E
0396:  RCALL  01D0
0398:  MOVLW  36
039A:  MOVWF  FF6
039C:  MOVLW  01
039E:  MOVWF  FF7
03A0:  MOVLW  06
03A2:  MOVWF  1D
03A4:  RCALL  01B2
03A6:  MOVLW  01
03A8:  MOVWF  1D
03AA:  MOVLW  37
03AC:  MOVWF  1E
03AE:  RCALL  01D0
03B0:  MOVLW  20
03B2:  MOVWF  20
03B4:  RCALL  016C
.................... 			int aux = send_i2c(addr_device, memory_addr, data_addr); 
03B6:  MOVLW  B0
03B8:  MOVWF  1D
03BA:  MOVLW  01
03BC:  MOVWF  1E
03BE:  MOVLW  55
03C0:  MOVWF  1F
03C2:  BRA    025A
03C4:  MOVFF  01,1C
.................... //			printf("  %s", (aux == 0xFF) ? "Err" : "Ok"); 
.................... 			if (aux == 0xFF) 
03C8:  INCFSZ 1C,W
03CA:  BRA    03D8
.................... 				printf(" Err"); 
03CC:  MOVLW  40
03CE:  MOVWF  FF6
03D0:  MOVLW  01
03D2:  MOVWF  FF7
03D4:  RCALL  0192
.................... 			else 
03D6:  BRA    03EA
.................... 				printf(" Ok"); 
03D8:  MOVLW  20
03DA:  MOVWF  20
03DC:  RCALL  016C
03DE:  MOVLW  4F
03E0:  MOVWF  20
03E2:  RCALL  016C
03E4:  MOVLW  6B
03E6:  MOVWF  20
03E8:  RCALL  016C
.................... 		} 
.................... 		delay_ms(1000); 
03EA:  MOVLW  04
03EC:  MOVWF  1D
03EE:  MOVLW  FA
03F0:  MOVWF  1E
03F2:  RCALL  0146
03F4:  DECFSZ 1D,F
03F6:  BRA    03EE
.................... 	} 
03F8:  BRA    02E2
.................... 	return 0; 
03FA:  MOVLW  00
03FC:  MOVWF  01
.................... } 
....................  
.................... /*		switch (cont++) { 
....................  case 0: 
....................  
....................  break; 
....................  case 1: 
....................  aux = 0; 
....................  printf("\fEnviando 0x%X\nem 0x%X :", data_addr, memory_addr); 
....................  aux = send_i2c(addr_device, memory_addr, data_addr); 
....................  printf("\n%s", aux == 0xFF ? "Error" : "Ok"); 
....................  break; 
....................  case 2: 
....................  aux = 0; 
....................  printf("\fLendo em 0x%X", memory_addr); 
....................  aux = read_i2c(addr_device, memory_addr); 
....................  printf("\nleitura: 0x%X", aux); 
....................  break; 
....................  default: 
....................  cont = 0; 
....................  break; 
....................  }*/ 
03FE:  SLEEP 

Configuration Fuses:
   Word  1: 2600   H4 NOOSCSEN
   Word  2: 0E0D   NOPUT NOBROWNOUT BORV20 NOWDT WDT128
   Word  3: 0100   CCP2C1
   Word  4: 0080   NOSTVREN NOLVP NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
